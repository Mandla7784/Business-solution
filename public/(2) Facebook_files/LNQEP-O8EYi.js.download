;/*FB_PKG_DELIM*/

__d("MAWGetProtocolMsgIdByMsgIdInUIIDB",["MAWIndexedDbUI","MAWTransactionMode","getProtocolMsgIdByMsgIdCommon"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDbUI").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getProtocolMsgByMsgId",function(a){return function(b){return d("getProtocolMsgIdByMsgIdCommon").getProtocolMsgIdByMsgIdCommon(a,b)}});g.MAWGetProtocolMsgIdByMsgIdInUIIDB=b}),98);
__d("MAWIDBOptimisticMessageUtils",["MAWAckLevel","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDbUI","MAWMessageSortOrderUtils","MAWTransactionMode","MAWTransactor","MAWWriteOutgoingMsgApi","WAJids","WAStanzaUtils","err"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDbUI").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,threads:a.READONLY},"sepReadgetQuotableMsgProtocolIdByMsgId",function(a){return function(b,e){return a.messages.get({msgId:b}).then(function(f){if(f==null||f.author===d("WAJids").AUTHOR_SYSTEM||f.author==="@system")throw c("err")("[separate read] No quotable message found for msgId %s",b);var g={author:f.author,chat:f.threadJid,externalId:f.externalId};return d("MAWWriteOutgoingMsgApi").getQuoteInfo(a,g,e).then(function(a){return{quote:g,quoteInfo:a}})})}});e=d("MAWTransactor").makeMsgrUIWritableTransactor({messages:a.READWRITE,threads:a.READONLY},"sepReadWriteMsg",function(a){return function(b,e){return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,e),d("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(a,e)]).then(function(f){var g=f[0];f=f[1];if(!g.success)throw c("err")("[separate read] Expected thread for optimistic message: jid %s",e);var h=d("MAWDbMsg").craftMsgIdV2(g.value.chatId,f?d("MAWDbMsg").getInChatMsgIdFromMsgId(f.msgId)+1:1,b);g=d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(b);return a.messages.add(babelHelpers["extends"]({},b,{msgId:h,sortOrderMs:g})).then(function(){return h})})}});f=d("MAWTransactor").makeMsgrUIWritableTransactor({messages:a.READWRITE},"sepReadMarkMessageSendAsFailed",function(a){return function(b,c,e){b=b.map(function(a){return{author:d("WAJids").AUTHOR_ME,chat:c,externalId:d("WAStanzaUtils").toStanzaId(a)}});return d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,b).then(function(b){b=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{ack:e?d("MAWAckLevel").ACK.failedRetryable:d("MAWAckLevel").ACK.failed})});return a.messages.bulkPut(b)})}});g.getQuoteByMsgId=b;g.writeMsgToDb=e;g.markMessageSendAsFailed=f}),98);
__d("MAWMarkMessageSendAsFailedIDB",["MAWIDBOptimisticMessageUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){return d("MAWIDBOptimisticMessageUtils").markMessageSendAsFailed([a],b,f).then(function(){})}g.markMessageSendAsFailed=a}),98);